<canvas id="window" width="512" height="512">
</canvas>

<script>
const canvas = document.getElementById("window");
const ctx = canvas.getContext("2d");

const testTriangles = [
    [
        [0, 1, -1],
        [0, 0, 1],
        [0, -1, -1],
        [-1, 1, 1],
        [-1, 0, -1],
        [-1, -1, 1]
    ], 
    
    [
        [[0,1,2], "blue"],
        [[3,4,5], "red"]
    ]
];
const objectList = [testTriangles];

var playerPos = [-3, 0, 0];
var playerRot = [0, 0, 0];

refreshScreen();
ray();


// rendering stuff

function ray() {
    for(let i=0; i<=objectList.length; i++) {
        window.alert(objectList[i][1].length);
        for(let j=0; j<=objectList[i][1].length; j++) {
            var n = normalizeVector3(cross(vector3Subtract(objectList[i][0][objectList[i][1][j][0][0]], objectList[i][0][objectList[i][1][j][0][1]]), vector3Subtract(objectList[i][0][objectList[i][1][j][0][0]], objectList[i][0][objectList[i][1][j][0][2]])));
            window.alert(n);
        }
    }
}










// math stuff

function cross(a, b){
    return [
        (a[1]*b[2])-(a[2]*b[1]),
        (a[2]*b[0])-(a[0]*b[2]),
        (a[0]*b[1])-(a[1]*b[0])
    ];
}

function vector3Subtract(a, b){
    return [
        a[0]-b[0],
        a[1]-b[1],
        a[2]-b[2]
    ];
}

function vector3Normalize(v) {
    var mag = Math.sqrt((v[0]*v[0])+(v[1]*v[1])+(v[2]*v[2]));
    return [
        v[0]/mag,
        v[1]/mag,
        v[2]/mag
    ];
}

// window stuff

window.addEventListener("keypress", function (event) {
    
    if (event.defaultPrevented) {
        return; // Do nothing if the event was already processed
    }

    switch (event.key) {
        case "w":
            playerPos[0] = playerPos[0]+(Math.cos(playerRot[2])*Math.cos(playerRot[1]));
            playerPos[1] = playerPos[1]+(Math.sin(playerRot[2])*Math.cos(playerRot[1]));
            playerPos[2] = playerPos[2]+(Math.sin(playerRot[1]));
            break;
        case "a":
            playerPos[0] = playerPos[0]+(Math.sin(playerRot[2])*Math.cos(playerRot[0]));
            playerPos[1] = playerPos[1]+(Math.cos(playerRot[2])*Math.cos(playerRot[0]));
            playerPos[2] = playerPos[2]+(Math.sin(playerRot[0]));
            break;
        case "s":
            playerPos[0] = playerPos[0]-(Math.cos(playerRot[2])*Math.cos(playerRot[1]));
            playerPos[1] = playerPos[1]-(Math.sin(playerRot[2])*Math.cos(playerRot[1]));
            playerPos[2] = playerPos[2]-(Math.sin(playerRot[1]));
            break;
        case "d":
            playerPos[0] = playerPos[0]-(Math.sin(playerRot[2])*Math.cos(playerRot[0]));
            playerPos[1] = playerPos[1]-(Math.cos(playerRot[2])*Math.cos(playerRot[0]));
            playerPos[2] = playerPos[2]-(Math.sin(playerRot[0]));
            break;



        case "u":
            playerRot[0] = playerRot[0]+1;
            break;
        case "i":
            playerRot[1] = playerRot[1]+1;
            break;
        case "o":
            playerRot[0] = playerRot[0]-1;
            break;
        case "j":
            playerRot[2] = playerRot[2]+1;
            break;
        case "k":
            playerRot[1] = playerRot[1]-1;
            break;
        case "l":
            playerRot[2] = playerRot[2]-1;
            break;
        default:
            return;
    }

    event.preventDefault();
    refreshScreen();

}, true);

function clear() {
    ctx.fillStyle = "black";
    ctx.fillRect(0, 0, 512, 512);
}

function drawDebug() {
    ctx.beginPath();
    ctx.moveTo(playerPos[0]+256, 256-playerPos[1]);
    ctx.lineTo((playerPos[0]+256)+(16*Math.cos(playerRot[2])*Math.cos(playerRot[1])), (256-playerPos[1])-(16*Math.sin(playerRot[2])*Math.cos(playerRot[1])));
    ctx.strokeStyle = "white";
    ctx.lineWidth = 4;
    ctx.stroke();
}

function refreshScreen() {
    clear();
    drawDebug();
}

</script>